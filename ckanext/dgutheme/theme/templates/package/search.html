<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:i18n="http://genshi.edgewall.org/i18n"
  xmlns:py="http://genshi.edgewall.org/"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  py:strip="">

  <xi:include href="../facets.html" />
  <py:def function="page_title">Search | data.gov.uk</py:def>
  <py:def function="page_heading">Search</py:def>

  <py:match path="primarysidebar">
    
    <li class="widget-container boxed widget_text" py:if="h.check_access('package_create')">
        <h2>Add a dataset</h2>
        <p>
            Do you know of a dataset that should be added to ${g.site_title}?
            <br/>
            
            <a href="${h.url_for(controller='package', action='new', id=None)}">Register it now</a>.
        </p>
    </li>
 
    <div id="filter-heading">
      <h1>Filters</h1>
      <p>You can filter the search results using the filters below</p>
    </div>

    <div id="map-based-search">
      <h2>UK Location Map Based Search</h2>
      <p>Place holder</p>
    </div>

    ${facet_sidebar('tags', if_empty='There are no further tag filters to apply.')}
    ${facet_sidebar('res_format', title=lambda n:'Resource Format', if_empty='There are no further resource format filters to apply.')}
    ${facet_sidebar('groups', label=h.group_name_to_title, if_empty='There are no further publisher filters to apply.')}

    <!-- Create a nested list of UKLP filters -->
    <div class="facet-box">
      <h2>UKLP Dataset Type</h2>
      <ul py:if="len(h.facet_items(c, 'resource-type'))">
        ${facet_list_items('UKLP', label=lambda n: 'UKLP', if_empty='UKLP')}
        <ul class="facet-options">
          ${facet_list_items('resource-type')}
        </ul>
      </ul>
      <p py:if="not len(h.facet_items(c, 'resource-type'))">There are no further UKLP filters to apply.</p>
    </div>

    ${facet_sidebar('license_id-is-ogl', title=lambda n: 'License', label=lambda n: 'Open Government License' if n == 'true' else 'Non-Open Government License', if_empty='There are no further license filters to apply.')}

    <li class="widget-container widget_text">
        <h4>Other access</h4>
<?python
  from pylons import config
  dumps_url = config.get('ckan.dumps_url')
  dumps_format = config.get('ckan.dumps_format', '')
?>
        <p>
            You can also access this registry using the 
            ${h.link_to(_('API'), h.url_for(controller='api', action='get_api', id=None))}
            (see ${h.link_to(_('API Docs'), 'http://wiki.ckan.net/API')})<py:if test="dumps_url">
                or download a <a href="${dumps_url}">full ${dumps_format} 
                dump</a></py:if>.
        </p>
    </li>
 
  </py:match>

  <div py:match="content">
    <xi:include href="search_form.html" />
    ${field_list()}   
    
      <py:if test="c.query_error">
        <p i18n:msg="item_count"><strong>There was an error while searching.</strong> 
            Please try again.</p>
      </py:if>
      <py:if test="request.params">      
        <h4 i18n:msg="item_count"><strong>${c.page.item_count}</strong> datasets found</h4>            
     </py:if>
      <py:if test="c.page.item_count == 0 and request.params">
        <p i18n:msg="">Would you like to <a href="${h.url_for(action='new', id=None)}">create a new dataset?</a></p>
      </py:if>
      ${package_list_from_dict(c.page.items)}
      ${c.page.pager(q=c.q)}

  </div>
  <xi:include href="layout.html" />
</html>


